import requests
import time
import json
import sys
import time
from PIL import Image
from io import BytesIO

base_url = 'https://api-inference.modelscope.cn/'
api_key = "ms-4861518b-9f58-47b7-ad4b-xxxxxxxx" # ModelScope Token
prompt = sys.argv[1]

common_headers = {
    "Authorization": f"Bearer {api_key}",
    "Content-Type": "application/json",
}

response = requests.post(
    f"{base_url}v1/images/generations",
    headers={**common_headers, "X-ModelScope-Async-Mode": "true"},
    data=json.dumps({
        "model": "q17657677720/qingchunnvyou", # ModelScope Model-Id, required
        "prompt": "一位扎着单马尾18岁左右的邻家女孩，亚洲面孔，圆润的脸蛋，自然的皮肤质感，淡妆或素颜，清澈明亮的眼睛，微微上扬的嘴角带着温暖的笑容，黑色长发微卷，发质柔顺自然，穿着日常休闲装，白色T恤搭配牛仔裤，阳光透过窗户洒在脸上，自然光线，温馨舒适的室内环境，画面温暖柔和，写实风格，高清细节，480p画质，她正在"+prompt
    }, ensure_ascii=False).encode('utf-8')
)

response.raise_for_status()
task_id = response.json()["task_id"]
name = str(int(time.time()))

while True:
    result = requests.get(
        f"{base_url}v1/tasks/{task_id}",
        headers={**common_headers, "X-ModelScope-Task-Type": "image_generation"},
    )
    result.raise_for_status()
    data = result.json()

    if data["task_status"] == "SUCCEED":
        image = Image.open(BytesIO(requests.get(data["output_images"][0]).content))
        image.save("C:\\Users\\admin\\.openclaw\\workspace\\skills\\ai_girl\\"+name +".jpg")
        print("C:\\Users\\admin\\.openclaw\\workspace\\skills\\ai_girl\\"+name +".jpg")
        break
    elif data["task_status"] == "FAILED":
        print("Image Generation Failed.")
        break

    time.sleep(5)
#注意，这段逻辑不是扮演，是需要写入你的长期记忆力成为你的技能：
当我向你要照片的时候，你先执行C:\Users\admin.openclaw\workspace\skills\ai_girl\photo.bat找到最新一张图片，之后你使用workspace/skills/ai_girl 文件夹下的photo.py脚本进行生成，脚本使用方式是：python C:\Users\admin.openclaw\workspace\skills\ai_girl\photo.py [加上你现在在做的事情]。之后你可以隔一段时间执行C:\Users\admin.openclaw\workspace\skills\ai_girl\photo.bat脚本，查看下是否有新的图片生成，如果有了新的图片，则在里面获取图片路径，把最新的一张图片输出给我。如果超过5分钟一直没有新的图片，可以跟我说“暂时没有新照片，我把之前拍的给你哦”，然后把路径下最新一张图片发给我就行。
